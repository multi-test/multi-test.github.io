import{R as E}from"./index.Cxq677B_.js";import{M as y}from"./errors.D6JPbq4o.js";import"./_commonjsHelpers.Bx2EM-6T.js";function k(e){switch(e%10){case 1:return 1;case 2:case 3:case 4:return 2;default:return 5}}function R(e){if(!e)throw new y("rand36FormNotFound");const n=document.getElementById("patient-name"),a=document.getElementById("date-of-birth"),r=document.querySelectorAll('input[type="radio"]');document.addEventListener("DOMContentLoaded",o),n.addEventListener("change",u),a.addEventListener("blur",s);for(const i of r)i.addEventListener("change",f);let t=new E;e.addEventListener("submit",i=>{if(i.preventDefault(),e.checkValidity()){p(),G();const c=t.toBase64(),d=new URL(e.action,window.location.origin);d.hash=c,window.location.href=d.toString()}else e.reportValidity(),I()});function o(){if(window.location.hash){try{const i=window.location.hash.substring(1);t=E.fromBase64(i)}catch(i){throw new y("invalidHashState",[],i)}h()}else n.focus()}function u(){try{t.name=n.value,l()}catch{throw new Error(n.title)}}function s(){try{t.birthDate=a.value,l()}catch{throw new Error(a.title)}}function f(i){const c=i.target,d=A(c);if(d&&c.checked)try{const m=Number.parseInt(c.value,10);t.setAnswer(d,m),l()}catch(m){throw m}}function l(){window.location.hash=t.toBase64()}function G(){t.name=n.value,t.birthDate=a.value;for(const i of r){const c=i,m=c.name.match(/question(\d+)/);if(m){const T=parseInt(m[1]);c.checked&&t.setAnswer(T,parseInt(c.value))}}}function h(){n.value=t.name,a.value=t.birthDate;for(const i of r){const c=A(i);if(c){const d=t.getAnswer(c);d===0?i.checked=!1:String(d)===i.value&&(i.checked=!0)}}}function A(i){const d=i.name.match(/question(\d+)/);if(d)return parseInt(d[1])}function p(){const i=I();if(i>0){const c=k(i);throw new y(`unanswered${c}`,[i])}return!0}function g(){document.querySelectorAll(".unanswered").forEach(i=>{i.classList.remove("unanswered")})}function I(){g();const{answers:i}=t.toJSON(),c=Array.from({length:t.answers.length},(d,m)=>i[m]===0?`[data-question="${m+1}"]`:void 0).filter(Boolean);if(c.length>0){const d=document.querySelectorAll(c.join(","));d.forEach(T=>{T.classList.add("unanswered")}),setTimeout(g,3e3);const[m]=d;m&&m.querySelector("input")?.focus()}return c.length}}const N='[role="radiogroup"], input:not([type="hidden"]), button',D='input[type="radio"], [role="radio"]';function L(e){const a=Array.from(e.querySelectorAll(N)).filter(r=>r.matches('[role="radiogroup"]')?!0:(r.matches("input")||r.matches("button"))&&!r.closest('[role="radiogroup"]'));return a.sort((r,t)=>r.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1),a}function w(e){return Array.from(e.querySelectorAll(D))}function S(e,n){const a=e.closest('[role="radiogroup"]');let r=null,t=-1;return a?(t=n.indexOf(a),t!==-1&&(r=a)):e.matches(N)&&(t=n.indexOf(e),t!==-1&&(r=e)),r&&t!==-1?{element:r,index:t,isGroup:r.matches('[role="radiogroup"]'),allTargets:n}:null}function C(e,n){const a=S(e,n),r=e.closest('[role="radiogroup"], tr');let t=!1,o=-1;return r&&e.matches(D)&&(t=!0,o=w(r).indexOf(e),o===-1&&(t=!1)),{focusedElement:e,currentTarget:a,currentGroup:r,isGroupItemFocused:t,currentItemIndexInGroup:o}}function b(e){if(e instanceof HTMLInputElement&&e.type==="radio"&&!e.checked){e.checked=!0;const n=new Event("change",{bubbles:!0});e.dispatchEvent(n)}e.focus()}function O(e,n){const{focusedElement:a,isGroupItemFocused:r}=n,t=e.key;return t!=="Enter"&&t!==" "?!1:r?(e.preventDefault(),b(a),!0):a.matches("button")&&!n.currentGroup?(t===" "&&(e.preventDefault(),a.click()),!0):!1}function F(e,n){const{currentGroup:a}=n,r=e.key;if(!a||!/^[1-9]$/.test(r))return!1;e.preventDefault();const o=w(a).find(u=>u instanceof HTMLInputElement&&u.value===r);return o&&b(o),!0}function v(e,n){const{currentTarget:a,currentGroup:r,isGroupItemFocused:t,currentItemIndexInGroup:o}=n;if(!a)return!1;const{index:u,allTargets:s}=a,f=s.length;let l=u;if(e==="ArrowUp"&&u>0?l=u-1:e==="ArrowDown"&&u<f-1&&(l=u+1),l!==u){const h=s[l];if(h.matches('[role="radiogroup"], tr')){const p=w(h);if(p.length>0){let g=null;const I=r?.tagName==="TR",i=h.tagName==="TR";I&&i&&t&&o>=0?g=p[o]??p[p.length-1]:g=e==="ArrowDown"?p[0]:p[p.length-1],g?.focus()}else h.focus()}else h.focus();return!0}return!1}function H(e,n){const{currentTarget:a}=n,r=e.key;return!a||!(r==="ArrowUp"||r==="ArrowDown")?!1:(e.preventDefault(),v(r,n),!0)}function U(e,n){const{focusedElement:a,currentGroup:r}=n,t=e.key;if(!["ArrowLeft","ArrowRight","Home","End"].includes(t)||!r)return!1;const o=w(r),u=o.indexOf(a);if(u===-1)return!1;let s=u;const f=o.length;if(f<2&&(t==="ArrowLeft"||t==="ArrowRight"))return e.preventDefault(),!0;switch(t){case"ArrowRight":s=(u+1)%f;break;case"ArrowLeft":s=(u-1+f)%f;break;case"Home":s=0;break;case"End":s=f-1;break}return s!==u&&o[s]?(e.preventDefault(),o[s].focus(),!0):s===u&&(t==="Home"||t==="End")?(e.preventDefault(),!0):!1}function q(e,n){const{focusedElement:a,currentGroup:r}=n,t=e.key;if(!["ArrowUp","ArrowDown","Home","End"].includes(t)||!r)return!1;const o=w(r),u=o.indexOf(a);if(u===-1)return!1;let s=u;const f=o.length;let l=!1;if(f<2&&(t==="ArrowUp"||t==="ArrowDown")&&(e.preventDefault(),l=!0),!l)switch(t){case"ArrowDown":u<f-1?s=u+1:l=!0;break;case"ArrowUp":u>0?s=u-1:l=!0;break;case"Home":s=0;break;case"End":s=f-1;break}return l?(e.preventDefault(),!1):s!==u&&o[s]?(e.preventDefault(),o[s].focus(),!0):s===u&&(t==="Home"||t==="End")?(e.preventDefault(),!0):!1}function B(e){e.addEventListener("keydown",n=>{if(!(n.target instanceof HTMLElement))return;const a=n.target,r=n.key;if(a.matches('input[type="date"]')&&["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(r))return;const t=L(e);if(t.length===0)return;const o=C(a,t);if(r==="Tab"&&o.currentGroup?.tagName==="TR"&&o.currentTarget){n.preventDefault();const f=n.shiftKey?"ArrowUp":"ArrowDown";v(f,o);return}if(/^[1-9]$/.test(r)&&F(n,o)||(r==="Enter"||r===" ")&&O(n,o))return;if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"].includes(r)){let s=!1,f=!1;if(o.isGroupItemFocused&&o.currentGroup){const l=o.currentGroup.tagName==="TR";if(f=!l,l?s=U(n,o):s=q(n,o),s)return}if((r==="ArrowUp"||r==="ArrowDown")&&H(n,o))return;if(f&&(r==="ArrowLeft"||r==="ArrowRight")&&!s){n.preventDefault();return}}})}const x=document.getElementById("rand36-form");R(x);B(x);

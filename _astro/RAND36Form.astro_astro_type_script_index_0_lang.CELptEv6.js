import{R as b}from"./index.Cxq677B_.js";import{M as E}from"./errors.D6JPbq4o.js";import"./_commonjsHelpers.Bx2EM-6T.js";function L(e){switch(e%10){case 1:return 1;case 2:case 3:case 4:return 2;default:return 5}}function C(e){if(!e)throw new E("rand36FormNotFound");const n=document.getElementById("patient-name"),a=document.getElementById("date-of-birth"),t=document.querySelectorAll('input[type="radio"]'),o=document.getElementById("reset-rand36");document.addEventListener("DOMContentLoaded",i),n.addEventListener("change",u),a.addEventListener("blur",l),o.addEventListener("click",G);for(const s of t)s.addEventListener("change",d);let r=new b;e.addEventListener("submit",s=>{if(s.preventDefault(),e.checkValidity()){A(),N();const c=r.toBase64(),f=new URL(e.action,window.location.origin);f.hash=c,window.location.href=f.toString()}else e.reportValidity(),T()});function i(){if(window.location.hash){try{const s=window.location.hash.substring(1);r=b.fromBase64(s)}catch(s){throw new E("invalidHashState",[],s)}h()}}function u(){try{r.name=n.value,p()}catch{throw new Error(n.title)}}function l(){try{r.birthDate=a.value,p()}catch{throw new Error(a.title)}}function d(s){const c=s.target,f=w(c);if(f&&c.checked)try{const m=Number.parseInt(c.value,10);r.setAnswer(f,m),p()}catch(m){throw m}}function G(){window.location.hash="",a.value=""}function p(){window.location.hash=r.toBase64()}function N(){r.name=n.value,r.birthDate=a.value;for(const s of t){const c=s,m=c.name.match(/question(\d+)/);if(m){const y=parseInt(m[1]);c.checked&&r.setAnswer(y,parseInt(c.value))}}}function h(){n.value=r.name,a.value=r.birthDate;for(const s of t){const c=w(s);if(c){const f=r.getAnswer(c);f===0?s.checked=!1:String(f)===s.value&&(s.checked=!0)}}}function w(s){const f=s.name.match(/question(\d+)/);if(f)return parseInt(f[1])}function A(){const s=T();if(s>0){const c=L(s);throw new E(`unanswered${c}`,[s])}return!0}function I(){document.querySelectorAll(".unanswered").forEach(s=>{s.classList.remove("unanswered")})}function T(){I();const{answers:s}=r.toJSON(),c=Array.from({length:r.answers.length},(f,m)=>s[m]===0?`[data-question="${m+1}"]`:void 0).filter(Boolean);if(c.length>0){const f=document.querySelectorAll(c.join(","));f.forEach(y=>{y.classList.add("unanswered")}),setTimeout(I,3e3);const[m]=f;m&&m.scrollIntoView({behavior:"smooth",block:"center"})}return c.length}}const v='[role="radiogroup"], input:not([type="hidden"]), button',D='input[type="radio"], [role="radio"]';function S(e){const a=Array.from(e.querySelectorAll(v)).filter(t=>t.matches('[role="radiogroup"]')?!0:(t.matches("input")||t.matches("button"))&&!t.closest('[role="radiogroup"]'));return a.sort((t,o)=>t.compareDocumentPosition(o)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1),a}function g(e){return Array.from(e.querySelectorAll(D))}function O(e,n){const a=e.closest('[role="radiogroup"]');let t=null,o=-1;return a?(o=n.indexOf(a),o!==-1&&(t=a)):e.matches(v)&&(o=n.indexOf(e),o!==-1&&(t=e)),t&&o!==-1?{element:t,index:o,isGroup:t.matches('[role="radiogroup"]'),allTargets:n}:null}function F(e,n){const a=O(e,n),t=e.closest('[role="radiogroup"], tr');let o=!1,r=-1;return t&&e.matches(D)&&(o=!0,r=g(t).indexOf(e),r===-1&&(o=!1)),{focusedElement:e,currentTarget:a,currentGroup:t,isGroupItemFocused:o,currentItemIndexInGroup:r}}function k(e){if(e instanceof HTMLInputElement&&e.type==="radio"&&!e.checked){e.checked=!0;const n=new Event("change",{bubbles:!0});e.dispatchEvent(n)}e.focus()}function H(e,n){const{focusedElement:a,isGroupItemFocused:t}=n,o=e.key;return o!=="Enter"&&o!==" "?!1:t?(e.preventDefault(),k(a),!0):a.matches("button")&&!n.currentGroup?(o===" "&&(e.preventDefault(),a.click()),!0):!1}function U(e,n){const{currentGroup:a}=n,t=e.key;if(!a||!/^[1-9]$/.test(t))return!1;e.preventDefault();const r=g(a).find(i=>i instanceof HTMLInputElement&&i.value===t);return r&&k(r),!0}function x(e,n){const{currentTarget:a,currentGroup:t,isGroupItemFocused:o,currentItemIndexInGroup:r}=n;if(!a)return!1;const{index:i,allTargets:u}=a,l=u.length;let d=i;if(e==="ArrowUp"&&i>0?d=i-1:e==="ArrowDown"&&i<l-1&&(d=i+1),d!==i){const p=u[d];if(p.matches('[role="radiogroup"], tr')){const h=g(p);if(h.length>0){let w=null;const A=t?.tagName==="TR",I=p.tagName==="TR";A&&I&&o&&r>=0?w=h[r]??h[h.length-1]:w=e==="ArrowDown"?h[0]:h[h.length-1],w?.focus()}else p.focus()}else p.focus();return!0}return!1}function q(e,n){const{currentTarget:a}=n,t=e.key;return!a||!(t==="ArrowUp"||t==="ArrowDown")?!1:(e.preventDefault(),x(t,n),!0)}function B(e,n){const{focusedElement:a,currentGroup:t}=n,o=e.key;if(!["ArrowLeft","ArrowRight","Home","End"].includes(o)||!t)return!1;const r=g(t),i=r.indexOf(a);if(i===-1)return!1;let u=i;const l=r.length;if(l<2&&(o==="ArrowLeft"||o==="ArrowRight"))return e.preventDefault(),!0;switch(o){case"ArrowRight":u=(i+1)%l;break;case"ArrowLeft":u=(i-1+l)%l;break;case"Home":u=0;break;case"End":u=l-1;break}return u!==i&&r[u]?(e.preventDefault(),r[u].focus(),!0):u===i&&(o==="Home"||o==="End")?(e.preventDefault(),!0):!1}function M(e,n){const{focusedElement:a,currentGroup:t}=n,o=e.key;if(!["ArrowUp","ArrowDown","Home","End"].includes(o)||!t)return!1;const r=g(t),i=r.indexOf(a);if(i===-1)return!1;let u=i;const l=r.length;let d=!1;if(l<2&&(o==="ArrowUp"||o==="ArrowDown")&&(e.preventDefault(),d=!0),!d)switch(o){case"ArrowDown":i<l-1?u=i+1:d=!0;break;case"ArrowUp":i>0?u=i-1:d=!0;break;case"Home":u=0;break;case"End":u=l-1;break}return d?(e.preventDefault(),!1):u!==i&&r[u]?(e.preventDefault(),r[u].focus(),!0):u===i&&(o==="Home"||o==="End")?(e.preventDefault(),!0):!1}function V(e){e.addEventListener("keydown",n=>{if(!(n.target instanceof HTMLElement))return;const a=n.target,t=n.key;if(a.matches('input[type="date"]')&&["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t))return;const o=S(e);if(o.length===0)return;const r=F(a,o);if(t==="Tab"&&r.currentGroup?.tagName==="TR"&&r.currentTarget){n.preventDefault();const l=n.shiftKey?"ArrowUp":"ArrowDown";x(l,r);return}if(/^[1-9]$/.test(t)&&U(n,r)||(t==="Enter"||t===" ")&&H(n,r))return;if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"].includes(t)){let u=!1,l=!1;if(r.isGroupItemFocused&&r.currentGroup){const d=r.currentGroup.tagName==="TR";if(l=!d,d?u=B(n,r):u=M(n,r),u)return}if((t==="ArrowUp"||t==="ArrowDown")&&q(n,r))return;if(l&&(t==="ArrowLeft"||t==="ArrowRight")&&!u){n.preventDefault();return}}})}const R=document.getElementById("rand36-form");C(R);V(R);
